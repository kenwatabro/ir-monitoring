# IRデータベース 要件定義書 v1.1

**作成日:** 2025‑06‑24  
**更新日:** 2025‑06‑24  
**作成者:** Kentaro Watanabe

---

## 1. 目的 (Purpose)
東証全上場企業（プライム／スタンダード／グロース）の IR 文書を収集・保存し、個人投資家としての分析・レポート生成を高速化するローカル基盤を構築する。将来のクラウド移行と公開を許容する設計とする。

## 2. スコープ (Scope)
| 項目 | In Scope | Out of Scope |
|------|----------|--------------|
| **データ源** | EDINET API v2 (有報・四半期報) / TDnet API (決算短信 PDF) / FRED・Trading Economics (マクロ) / Stooq CSV (株価) | ESG 報告書・大量保有報告・適時開示全文 |
| **期間** | 過去 5 年分 + 以降の日次更新 | 5 年以前の文書 |
| **処理** | ダウンロード / 重複排除 / XBRL & OCR パース / RDB 格納 / REST + FTS | Web GUI, パフォーマンスチューニング beyond stated targets |
| **利用者** | 作成者本人（ローカル LAN 内） | 外部一般ユーザー（後日） |

### 2.1 ビジネス KPI
| KPI | 目標値 |
|------|------|
| **初期ロード完了日** | 2025‑07‑02 |
| **日次更新完了時刻** | 当日 09:00 JST |

## 3. ステークホルダー
| 役割 | 氏名 | 責務 |
|------|------|------|
| オーナー / 開発者 | Kentaro Watanabe | 要件策定・実装・運用 |

## 4. 前提・制約
1. 実行環境: Intel N100 / 16 GB RAM / 512 GB SSD / Ubuntu 22.04。  
2. 年間運用コスト上限: 10,000 円（電気代 + API 課金）。  
3. データは社内利用のみ、再配信は行わない（TDnet ライセンス遵守）。

## 5. 機能要件 (FR)
| 番号 | 要件 | 優先度 |
|------|------|------|
| **FR‑1** | 日次 08:00 JST に EDINET/TDnet 文書を自動取得 | ★★★ |
| FR‑2 | SHA‑256 による重複排除と Raw 保存 | ★★★ |
| FR‑3 | XBRL パース → facts テーブル格納 | ★★★ |
| FR‑4 | PDF → OCR → pdf_texts 格納 | ★★☆ |
| **FR‑5** | REST API で KPI / 文書メタ情報提供 | ★★☆ |
| FR‑6 | CLI & API でオンデマンド再取得 | ★★☆ |
| **FR‑7** | 取得・変換・アクセスの監査ログ出力 | ★★☆ |
| **FR‑8** | Full‑Text Search：`pdf_texts_fts` による全文検索 | ★★ |
| **FR‑9** | マクロ指標 (PMI, Yield, FX) を日次取得し `macro_series` テーブルへ格納 | ★★ |
| **FR‑10** | 株価 OHLCV・信用残・TDnet 見出し指標を日次取得し `market_series` へ格納 | ★★ |
| **FR‑11** | ESG 指標（自社報告・無料 API スコア）を四半期取得し `esg_scores` へ格納 | ★ |

## 6. 非機能要件 (NFR)
| カテゴリ | 指標・目標 |
|----------|-----------|
| **性能効率** | 95% の API 応答 < 500 ms |
| **信頼性** | バッチ失敗率 < 1%（自動再試行除く） |
| **可用性** | 年間稼働率 ≥ 95% |
| **保守性** | pytest カバレッジ ≥ 80% / PEP‑8 準拠 |
| **拡張性** | OLTP / OLAP 分離・Docker Compose 採用 |
| **セキュリティ** | LAN ACL、将来 JWT + HTTPS / 鍵 rotate 90 日 |
| **監査性** | audit_log 保存 365 日 + GDPR 非該当確認 |
| **災害復旧** | **RPO ≤ 24 h / RTO ≤ 4 h** |

## 7. データ要件
- **初期ロード期間:** 2019‑04‑01 ～ 現在  
- **推定総量:** Raw ≈ 125 GB + OCR Text ≈ 40 GB + DB ≈ 30 GB  
- **アーカイブ:** Raw ZIP/PDF は 13 ヶ月経過後に外付け HDD へ自動退避

## 8. 受入れ基準 (Acceptance)
1. 初期ロード後、文書欠損率 < 1%。  
2. KPI API 応答 < 500 ms。  
3. audit_log に日次 INFO 記録が存在。  
4. RPO/RTO 検証で目標を満たす。

---

## 9. 認可と改訂履歴
| 版 | 承認者 | 日付 | 摘要 |
|----|--------|------|------|
| v1.1 | Kentaro Watanabe | 2025‑06‑24 | KPI・FTS・RPO/RTO・Raw アーカイブ追記 |

# IRデータベース 要件定義書 v1.2

